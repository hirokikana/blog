machine:
  environment:
    NOKOGIRI_USE_SYSTEM_LIBRARIES: true

dependencies:
  post:
    - bundle exec jekyll build

test:
  post:
    - bundle exec htmlproofer ./_site --check-html --disable-external

deployment:
  prod:
    branch: master
    commands:
      - echo $CLIENT_SECRET | base64 --decode > ${HOME}/gcloud-service-key.json
      - sudo /opt/google-cloud-sdk/bin/gcloud --quiet components update
      - gcloud auth activate-service-account --key-file ${HOME}/gcloud-service-key.json 
      - gcloud config set hiroki-kana
      - gsutil ls gs://blog.hirokikana.com/
